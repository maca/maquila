// Maquila
// version: 0.1.1
// author: Macario Ortega
// license: MIT
(function(){var a,b,c,d;d=function(a){var b;return b=Array.prototype.slice.call(arguments,1),function(){return a.apply(this,b.concat(Array.prototype.slice.call(arguments,0)))}},c={define:function(a,b){return null==b&&(b=Object),null==this.factories&&(this.factories={}),this.factories[a]=new this.Factory(b,this.strategies)},factory:function(a){return null==this.factories&&(this.factories={}),this.factories[a]||function(){throw"factory '"+a+"' is not defined"}()},resetSequences:function(){var a,b,c;c=this.factories;for(b in c)a=c[b],a.resetSequence();return this},attributes:function(a,b){return this.factory(a).attributes(b)},strategies:{build:function(a,b){return new a(b)},create:function(a,b){return a.create(b)}},strategy:function(a,b){var e,f;this.strategies[a]=b,this[a]=d(c.execute,a),f=this.factories;for(a in f)e=f[a],e.refreshStrategies();return this},execute:function(a,b,c){return this.factory(b)[a](c)}},c.build=d(c.execute,"build"),c.create=d(c.execute,"create"),a=function(){function a(a,b){var c;this.factory=a,this.length=b;for(c in this.factory.strategies)this[c]=d(this.execute,c)}return a.prototype.attributes=function(a){var b,c,d,e;for(e=[],b=c=1,d=this.length;d>=1?d>=c:c>=d;b=d>=1?++c:--c)e.push(this.factory.attributes(a));return e},a.prototype.execute=function(a,b){var c,d,e,f;for(f=[],c=d=1,e=this.length;e>=1?e>=d:d>=e;c=e>=1?++d:--d)f.push(this.factory[a](b));return f},a}(),b=function(){function a(a){this.start=null!=a?a:1,this.sequence=this.start}return a.prototype.increment=function(){return this.sequence+=1},a.prototype.reset=function(){return this.sequence=this.start},a}(),c.Factory=function(){function e(a,b){this.Constructor=a,this.defaultAttrs={},this.strategies=Object.create(b),this.refreshStrategies(),this.setNewCounter()}return e.prototype.setNewCounter=function(a){return null==a&&(a=1),this.counter=new b(a),this},e.prototype.defaults=function(a){var b,c;for(b in a)c=a[b],this.defaultAttrs[b]=c;return this},e.prototype.attributes=function(a){var b,c,d,e;null==a&&(a={}),b={},e=this.defaultAttrs;for(c in e)d=e[c],b[c]=d;for(c in a)d=a[c],b[c]=d;for(c in b)d=b[c],b[c]="function"==typeof d?d.apply(this,[b]):d;return this.incrementSequence(),b},e.prototype.strategy=function(a,b){return this.strategies[a]=b,this.refreshStrategies(),this},e.prototype.refreshStrategies=function(){var a;for(a in this.strategies)this[a]=d(this.execute,a);return this},e.prototype.extend=function(a){var b;return b=c.factory(a),this.counter=b.counter,this.strategies=Object.create(b.strategies),this.defaults(b.defaultAttrs),this.refreshStrategies(),this},e.prototype.arrayOf=function(b){return new a(this,b)},e.prototype.sequence=function(){return this.counter.sequence},e.prototype.incrementSequence=function(){return this.counter.increment()&&this},e.prototype.resetSequence=function(){return this.counter.reset()&&this},e.prototype.execute=function(a,b){return this.strategies[a](this.Constructor,this.attributes(b))},e}(),("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports.Maquila=c:this.Maquila=c}).call(this);